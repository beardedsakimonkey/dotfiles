# <pfx> d => detach-session
# <pfx> z => zoom active pane
# set is an alias for set-option
# bind is an alias for bind-key

# prevent tmux from creating login shells for new windows (avoids sourcing
# `.profile`, `.zprofile`, `.zlogin`)
set -g default-command "$SHELL"

set -g prefix C-a
set -s escape-time 0
set -g mouse on
set -g history-limit 100000
set -g base-index 1
set -gw pane-base-index 1
set -g renumber-windows on

# display a message when activity is detected in a window
set -g visual-activity on

set -g display-time 1000
set -g display-panes-time 5000

# true color, italic
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc:"

# FIXME
# cpu='uptime|awk \\'{split(substr($0, index($0, "load")), a, ":"); print a[2]}\\''
# setenv -gu cpu
# set -ga status-right "#($cpu)"

set -g status-left ''
set -g status-right ''
set -g status-style 'bg=terminal fg=terminal'

set -gw window-status-format         "#[fg=colour8]#I:#W "
set -gw window-status-current-format "#I:#W "

set -gw pane-border-style        'fg=colour238'
set -gw pane-active-border-style 'fg=#80a0ff'

# selection color in copy-mode
set -gw mode-style 'fg=#cec15c bg=#5b5b26'
set -gw mode-keys vi

bind C-a send-prefix
bind C-n next-window
bind C-p previous-window
bind q kill-pane
bind C-q kill-window
bind C-s new-window
bind s new-window
bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind i split-window -h -c "#{pane_current_path}"
bind C-i split-window -h -c "#{pane_current_path}"
bind m split-window -c "#{pane_current_path}"
bind C-m split-window -c "#{pane_current_path}"
bind C-z last-window
bind H join-pane -b -h -t !
bind J join-pane -t !
bind S-Left swap-window -t -1
bind S-Right swap-window -t +1
bind r source ~/.config/tmux/tmux.conf \; display 'Configuration reloaded'
bind C-b break-pane
bind C-[ copy-mode
bind C-] paste-buffer

# repeat last shell command in last active pane
bind a if -F -t! '#{m:*sh,#{pane_current_command}}' { send Up Enter }

# e(x)change
bind x swapp -U
bind X swapp -D

bind -T copy-mode-vi ( send-keys -X top-line
bind -T copy-mode-vi ) send-keys -X bottom-line
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

unbind -T root MouseDown3Pane
unbind -T copy-mode-vi 'v'
bind -T copy-mode-vi 'v' send-keys -X begin-selection

if-shell '[[ `uname` = Darwin ]]' \
  'bind -T copy-mode-vi "y" send-keys -X copy-pipe-and-cancel "pbcopy"' \
  'bind -T copy-mode-vi "y" send-keys -X copy-selection-and-cancel'

set -g @fingers-key "-n M-f"

set -g @fingers-main-action ':paste:'
set -g @fingers-shift-action ':copy:'

set -g @fingers-hint-format '#[fg=cyan,bold]%s'
set -g @fingers-hint-format-nocompact '#[fg=cyan,bold][%s]'

set -g @fingers-highlight-format '#[fg=red,bold,dim]%s'
set -g @fingers-highlight-format-nocompact '#[fg=red,bold,dim]%s'

# tmux-fingers
run-shell ~/.config/tmux/tmux-fingers/tmux-fingers.tmux

